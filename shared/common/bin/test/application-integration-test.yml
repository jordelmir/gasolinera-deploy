# Integration Test Configuration
spring:
  profiles:
    active: integration-test

  # Database Configuration (will be overridden by TestContainers)
  datasource:
    url: jdbc:postgresql://localhost:5432/gasolinera_jsm_test
    username: test_user
    password: test_password
    driver-class-name: org.postgresql.Driver

  # JPA Configuration
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true

  # Redis Configuration (will be overridden by TestContainers)
  redis:
    host: localhost
    port: 6379
    timeout: 2000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0

  # RabbitMQ Configuration (will be overridden by TestContainers)
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    connection-timeout: 30s

  # Flyway Configuration
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: false

  # Jackson Configuration
  jackson:
    property-naming-strategy: SNAKE_CASE
    default-property-inclusion: NON_NULL
    serialization:
      write-dates-as-timestamps: false

  # Logging Configuration
  logging:
    level:
      com.gasolinerajsm: DEBUG
      org.springframework.web: DEBUG
      org.springframework.security: DEBUG
      org.testcontainers: INFO
      org.hibernate.SQL: DEBUG
      org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    pattern:
      console: '%d{HH:mm:ss.SSS} [%thread] %-5level [%X{traceId},%X{spanId}] %logger{36} - %msg%n'

# Management Endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Test-specific Configuration
test:
  containers:
    reuse: true
    ryuk:
      disabled: true

  # JWT Configuration for tests
  jwt:
    secret: test-secret-key-for-integration-tests-only
    expiration: 3600000 # 1 hour

  # QR Code Configuration for tests
  qr:
    public-key: test-public-key
    private-key: test-private-key

  # Geofence Configuration for tests
  geofence:
    radius-meters: 100

# Async Configuration
async:
  core-pool-size: 2
  max-pool-size: 4
  queue-capacity: 100
  thread-name-prefix: test-async-

# Cache Configuration
cache:
  ttl:
    default: 300 # 5 minutes
    user-session: 1800 # 30 minutes
    coupon-validation: 60 # 1 minute
